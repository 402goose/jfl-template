#!/bin/bash
# Pre-commit hook to prevent session metadata from being committed
#
# This hook prevents accidental commits of session-specific files that should
# remain local-only. These files are in .gitignore but might be force-added.
#
# Install: ln -sf ../../scripts/hooks/pre-commit .git/hooks/pre-commit

# Check for session metadata files that should never be committed
BLOCKED_FILES=$(git diff --cached --name-only | grep -E '(current-session-branch\.txt|current-worktree\.txt|journal~|worktree-path\.txt)')

if [ -n "$BLOCKED_FILES" ]; then
    echo "‚ùå ERROR: Attempting to commit session metadata files"
    echo ""
    echo "These files should never be committed:"
    echo "$BLOCKED_FILES"
    echo ""
    echo "Run: git reset HEAD <file> to unstage them"
    echo "They are in .gitignore and should remain local only."
    echo ""
    echo "Session metadata files are machine-specific and will cause"
    echo "merge conflicts when switching between sessions."
    exit 1
fi

exit 0
